<!DOCTYPE html>
<!-- this file is auto-generated from webgl/lessons/ja/webgl-3d-camera.md. Do not edited directly -->
<!--
Copyright 2021 GFXFundamentals.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

*   Redistributions of source code must retain the above copyright
    notice, this list of conditions and the following disclaimer.

*   Redistributions in binary form must reproduce the above
    copyright notice, this list of conditions and the following disclaimer
    in the documentation and/or other materials provided with the
    distribution.

*   Neither the name of GFXFundamentals. nor the names of his
    contributors may be used to endorse or promote products derived from
    this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="WebGLでカメラの計算し方">
<meta name="keywords" content="webgl graphics">
<meta name="thumbnail" content="https://webglfundamentals.org/webgl/lessons/screenshots/webgl-3d-camera_ja.jpg">

<meta property="og:title" content="WebGL三次元でカメラ">
<meta property="og:type" content="website">
<meta property="og:image" content="https://webglfundamentals.org/webgl/lessons/screenshots/webgl-3d-camera_ja.jpg">
<meta property="og:description" content="WebGLでカメラの計算し方">
<meta property="og:url" content="https://webglfundamentals.org/webgl/lessons/ja/webgl-3d-camera.html">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@greggman">
<meta name="twitter:creator" content="@greggman">
<meta name="twitter:domain" content="webglfundamentals.org">
<meta name="twitter:title" content="WebGL三次元でカメラ">
<meta name="twitter:url" content="https://webglfundamentals.org/webgl/lessons/ja/webgl-3d-camera.html">
<meta name="twitter:description" content="WebGLでカメラの計算し方">
<meta name="twitter:image:src" content="https://webglfundamentals.org/webgl/lessons/screenshots/webgl-3d-camera_ja.jpg">

<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@graph":[
    {
      "@type":"WebSite",
      "@id":"https://webglfundamentals.org/#website",
      "url":"https://webglfundamentals.org/",
      "name":"WebglFundamentals"
    },
    {
      "@type":"ImageObject",
      "@id":"https://webglfundamentals.org/webgl/lessons/ja/webgl-3d-camera.html#primaryimage",
      "url":"https://webglfundamentals.org/webgl/lessons/screenshots/webgl-3d-camera_ja.jpg",
      "width":1200,
      "height":630
    },
    {
      "@type":"WebPage",
      "@id":"https://webglfundamentals.org/webgl/lessons/ja/webgl-3d-camera.html#webpage",
      "url":"https://webglfundamentals.org/webgl/lessons/ja/webgl-3d-camera.html",
      "inLanguage":"ja",
      "name":"WebGL三次元でカメラ",
      "keywords":"webgl graphics programming",
      "isPartOf":{
        "@id":"https://webglfundamentals.org/#website"
      },
      "primaryImageOfPage":{
        "@id":"https://webglfundamentals.org/webgl/lessons/ja/webgl-3d-camera.html#primaryimage"
      }
    }
  ]
}
</script>


<title>WebGL三次元でカメラ</title>
<link href="/webgl/lessons/resources/webglfundamentals-icon.png" rel="shortcut icon" type="image/png">
<link rel="stylesheet" href="/webgl/lessons/lang.css">
<link rel="stylesheet" href="/webgl/lessons/resources/lesson.css">

  <link rel="alternate" hreflang="en" href="https://webglfundamentals.org/webgl/lessons/webgl-3d-camera.html">
  <link rel="alternate" hreflang="fr" href="https://webglfundamentals.org/webgl/lessons/fr/webgl-3d-camera.html">
  <link rel="alternate" hreflang="ja" href="https://webglfundamentals.org/webgl/lessons/ja/webgl-3d-camera.html">
  <link rel="alternate" hreflang="ko" href="https://webglfundamentals.org/webgl/lessons/ko/webgl-3d-camera.html">
  <link rel="alternate" hreflang="pl" href="https://webglfundamentals.org/webgl/lessons/pl/webgl-3d-camera.html">
  <link rel="alternate" hreflang="pt-br" href="https://webglfundamentals.org/webgl/lessons/pt-br/webgl-3d-camera.html">
  <link rel="alternate" hreflang="ru" href="https://webglfundamentals.org/webgl/lessons/ru/webgl-3d-camera.html">
  <link rel="alternate" hreflang="uk" href="https://webglfundamentals.org/webgl/lessons/uk/webgl-3d-camera.html">
  <link rel="alternate" hreflang="zh_cn" href="https://webglfundamentals.org/webgl/lessons/zh_cn/webgl-3d-camera.html">




</head>
<body>
<div class="webgl_navbar">
  <div>
    <select class="language">
    <option value="/webgl/lessons/webgl-3d-camera.html" >English</a>
    <option value="/webgl/lessons/fr/webgl-3d-camera.html" >Français</a>
    <option value="/webgl/lessons/ja/webgl-3d-camera.html" selected>日本語</a>
    <option value="/webgl/lessons/ko/webgl-3d-camera.html" >한국어</a>
    <option value="/webgl/lessons/pl/webgl-3d-camera.html" >Polski</a>
    <option value="/webgl/lessons/pt-br/webgl-3d-camera.html" >Portuguese</a>
    <option value="/webgl/lessons/ru/webgl-3d-camera.html" >Русский</a>
    <option value="/webgl/lessons/uk/webgl-3d-camera.html" >Українська</a>
    <option value="/webgl/lessons/zh_cn/webgl-3d-camera.html" >简体中文</a>
</select>


    <a href="#toc">目次</a>
  </div>
</div>
<div class="webgl_header">
  <h1><a href="/webgl/lessons/ja/">WebGLFundamentals.org</a></h1>
<style>
#forkongithub>div {
    background: #000;
    color: #fff;
    font-family: arial,sans-serif;
    text-align: center;
    font-weight: bold;
    padding: 5px 40px;
    font-size: 0.9rem;
    line-height: 1.3rem;
    position: relative;
    transition: 0.5s;
    display: block;
    width: 400px;
    position: absolute;
    top: 0;
    right: 0;
    transform: translateX(200px) rotate(45deg) translate(10px,70px);
    box-shadow: 4px 4px 10px rgba(0,0,0,0.8);
    pointer-events: auto;
}
#forkongithub a {
  text-decoration: none;
  color: #fff;
}
#forkongithub>div:hover {
    background: #c11;
    color: #fff;
}
#forkongithub .contributors {
  font-size: 0.75rem;
  background: rgba(255,255,255,0.2);
  line-height: 1.2;
  padding: 0.1em;
}
#forkongithub>div::before,#forkongithub>div::after {
    content: "";
    width: 100%;
    display: block;
    position: absolute;
    top: 1px;
    left: 0;
    height: 1px;
    background: #fff;
}
#forkongithub>div::after {
    bottom: 1px;
    top: auto;
}

#forkongithub{
    z-index: 9999;
    /* needed for firefox */
    overflow: hidden;
    width: 300px;
    height: 300px;
    position: absolute;
    right: 0;
    top: 0;
    pointer-events: none;
}
#forkongithub svg{
  width: 1em;
  height: 1em;
  vertical-align: middle;
}
#forkongithub img {
  width: 1em;
  height: 1em;
  border-radius: 100%;
  vertical-align: middle;
}

@media (max-width: 900px) {
    #forkongithub>div {
        line-height: 1.2rem;
    }
}
@media (max-width: 700px) {
  #forkongithub {
    display: none;
  }
}
@media (max-width: 410px) {
    #forkongithub>div {
        font-size: 0.7rem;
        transform: translateX(150px) rotate(45deg) translate(20px,40px);
    }
}

</style>
<div id="forkongithub"><div><div><a href="https://github.com/gfxfundamentals/webgl-fundamentals">Fix, Fork, Contribute <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 136 133" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(3.92891,0,0,3.92891,67.867,129.125)">
        <path d="M0,-31.904C-8.995,-31.904 -16.288,-24.611 -16.288,-15.614C-16.288,-8.417 -11.621,-2.312 -5.148,-0.157C-4.333,-0.008 -4.036,-0.511 -4.036,-0.943C-4.036,-1.329 -4.05,-2.354 -4.058,-3.713C-8.589,-2.729 -9.545,-5.897 -9.545,-5.897C-10.286,-7.779 -11.354,-8.28 -11.354,-8.28C-12.833,-9.29 -11.242,-9.27 -11.242,-9.27C-9.607,-9.155 -8.747,-7.591 -8.747,-7.591C-7.294,-5.102 -4.934,-5.821 -4.006,-6.238C-3.858,-7.29 -3.438,-8.008 -2.972,-8.415C-6.589,-8.826 -10.392,-10.224 -10.392,-16.466C-10.392,-18.244 -9.757,-19.698 -8.715,-20.837C-8.883,-21.249 -9.442,-22.905 -8.556,-25.148C-8.556,-25.148 -7.188,-25.586 -4.076,-23.478C-2.777,-23.84 -1.383,-24.02 0.002,-24.026C1.385,-24.02 2.779,-23.84 4.08,-23.478C7.19,-25.586 8.555,-25.148 8.555,-25.148C9.444,-22.905 8.885,-21.249 8.717,-20.837C9.761,-19.698 10.392,-18.244 10.392,-16.466C10.392,-10.208 6.583,-8.831 2.954,-8.428C3.539,-7.925 4.06,-6.931 4.06,-5.411C4.06,-3.234 4.04,-1.477 4.04,-0.943C4.04,-0.507 4.333,0 5.16,-0.159C11.628,-2.318 16.291,-8.419 16.291,-15.614C16.291,-24.611 8.997,-31.904 0,-31.904" style="fill:white;"/>
    </g>
</svg>
</a></div></div></div>

</div>


<div class="container">
  <div class="lesson-title">
    <h1>WebGL三次元でカメラ</h1>
  </div>
  <div class="lesson">
    <div class="lesson-main">
      <p>この記事はWebGLシリーズのーつである。最初の記事は<a href="webgl-fundamentals.html">WebGLの基本で始まった</a>。 
そして、前回の記事は<a href="webgl-3d-perspective.html">透視投影</a>についてだった。まだ読んでいなかったら先に読んで下さい。</p>
<p>前回の記事で、<code class="notranslate" translate="no">m4.perspective</code>の関数が原点(0,0,0)から<code class="notranslate" translate="no">-zNear</code>〜<code class="notranslate" translate="no">-zFar</code>の空間を描画するので、
「F」をその錘台の中に移動しなければいけなかった。</p>
<p>現実の世界でカメラを移動して、撮影したい物（ビル、山、森）に向ける。</p>
<p><div class="webgl_diagram_container">
  <iframe class="webgl_example " style="width: 400px; height: 300px;" src="/webgl/lessons/resources/camera-move-camera.html?mode=0"></iframe>
  <div class="webgl_center">カメラを物に移動する。</div>
</div>

</p>
<p>現実の世界で何かを撮影したい場合、その物をカメラの前に移動することはほとんどない。</p>
<p><div class="webgl_diagram_container">
  <iframe class="webgl_example " style="width: 400px; height: 300px;" src="/webgl/lessons/resources/camera-move-camera.html?mode=1"></iframe>
  <div class="webgl_center">物をカメラに移動する。</div>
</div>

</p>
<p>でも前回の記事で出来た透視投影が原点から-Zの方に向いていた。
今回の目的を達成する為にカメラを原点に移動して、他のものを全てカメラの移動と連動して相対的に移動しなければいけない。</p>
<p><div class="webgl_diagram_container">
  <iframe class="webgl_example " style="width: 400px; height: 300px;" src="/webgl/lessons/resources/camera-move-camera.html?mode=2"></iframe>
  <div class="webgl_center">物をビューに移動する。</div>
</div>

</p>
<p>その結果を出すためにワールドをカメラの前に移動するようにしなければいけない。
それに逆行列を使えばいい。逆行列を計算する方法は複雑だが、コンセプトは簡単である。
逆行列はある行列を否定する行列である。例えば123の逆は-123である。5倍拡大行列の逆行列は
0.2縮小行列である。X軸で30度に回転行列の逆行列はX軸で-30度の行列である。</p>
<p>今まで「F」の位置と向きを調整するために移動、回転、拡大縮小行列を使った。
全部掛け合わせたら、その移動、回転、スケールが一つの行列で表している。
カメラでも同じように出来る。カメラを原点から好きな位置に移動して、
好きな向きに回転する行列が出来たら、その行列の逆行列を計算して、
その逆行列でカメラが原点から-Zの方に向いて、表示したいものを全てカメラの前に移動出来る。</p>
<p>上の「F」の円のような三次元シーンを作成しよう。</p>
<p>まず、5つの物を描画して、全部同じ投影行列を使うので、ループの前に透視投影行列を計算する。</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">
// 透視投影行列を計算する。
var aspect = gl.canvas.clientWidth / gl.canvas.clientHeight;
var zNear = 1;
var zFar = 2000;
var projectionMatrix = m4.perspective(fieldOfViewRadians, aspect, zNear, zFar);
</code></pre><p>次にカメラの行列を計算する。この行列はカメラの位置と向きを表している。
下記のコードは向きが常に原点で、原点から<code class="notranslate" translate="no">radius</code>を1.5掛けの距離で回転している行列を作成する。</p>
<p><div class="webgl_diagram_container">
  <iframe class="webgl_example " style="width: 400px; height: 300px;" src="/webgl/lessons/resources/camera-move-camera.html?mode=3"></iframe>
  <div class="webgl_center">カメラの動き</div>
</div>

</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">var numFs = 5;
var radius = 200;

// カメラ行列を計算する。
var cameraMatrix = m4.yRotation(cameraAngleRadians);
cameraMatrix = m4.translate(cameraMatrix, 0, 0, radius * 1.5);
</code></pre><p>そして、カメラ行列からビュー行列を計算する。
ビュー行列はある物を全てカメラの前に移動する行列である。カメラは原点にあるとして、
他のものがカメラと相対しているように移動出来るような行列である。
<code class="notranslate" translate="no">inverse</code>という関数を使ってカメラ行列の逆行列計算が出来る。</p>
<p>この場合、カメラ行列は原点を基点とした位置と向きでカメラが移動する行列である。
その行列を<code class="notranslate" translate="no">inverse</code>関数に与えて、
出た逆行列はカメラを原点にして、他の物がカメラと相対的に移動する。</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">// カメラ行列からビュー行列を作成する。
var viewMatrix = m4.inverse(cameraMatrix);
</code></pre><p>そして、ビュー行列と投影行列を組み合わせてビュー投影行列を作成する。</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">// ビュー投影行列を計算する。
var viewProjectionMatrix = m4.multiply(projectionMatrix, viewMatrix);
</code></pre><p>最後に、「F」の円を描画する。「F」ごとにビュー投影行列から始まって、そして回転して、<code class="notranslate" translate="no">radius</code>単位で外側へ移動する。</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">for (var ii = 0; ii &lt; numFs; ++ii) {
  var angle = ii * Math.PI * 2 / numFs;
  var x = Math.cos(angle) * radius;
  var y = Math.sin(angle) * radius

  // ビュー投影行列から「F」の行列を計算する。
  var matrix = m4.translate(viewProjectionMatrix, x, 0, y);

  // 行列を設定する。
  gl.uniformMatrix4fv(matrixLocation, false, matrix);

  // 図形を描画する。
  var primitiveType = gl.TRIANGLES;
  var offset = 0;
  var count = 16 * 6;
  gl.drawArrays(primitiveType, offset, count);
}
</code></pre><p>「F」の円の周りを回転しているカメラの出来上がり！<code class="notranslate" translate="no">カメラ角度</code>のスライダでカメラを移動してみて下さい。</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-3d-camera.html%3Fui-cameraAngle%3D%25E3%2582%25AB%25E3%2583%25A1%25E3%2583%25A9%25E8%25A7%2592%25E5%25BA%25A6"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-3d-camera.html?ui-cameraAngle=%E3%82%AB%E3%83%A1%E3%83%A9%E8%A7%92%E5%BA%A6" target="_blank">クリックして別のウインドウを開く</a>
</div>

</p>
<p>それで良しとすることも出来るけど、移動と回転でカメラを目標に向かせることはあまり簡単ではないような気がする。
例えば一つの特定の「F」を目指したければ、「F」の円の回りに回っているカメラが特定の「F」に向ける計算はウンザリするものかもしれない。</p>
<p>幸いにも、もっと簡単な方法がある。カメラの位置を好きにして、目標も好きにして、そのデータで行列の計算が出来る。
行列の動き方で驚くほど簡単である。</p>
<p>まず、カメラの位置を決める。それは「<code class="notranslate" translate="no">cameraPosition</code>」と呼ぶ。そして、目標を位置も決める。
それは「 <code class="notranslate" translate="no">target</code>」と呼ぶ。<code class="notranslate" translate="no">cameraPosition</code>から<code class="notranslate" translate="no">target</code>を引くとカメラから目標を目指しているベクトルが出る。それは<code class="notranslate" translate="no">zAxis</code>と呼ぼう。
カメラは-Zの方向に向かうので逆に計算しよう「<code class="notranslate" translate="no">cameraPosition - target</code>」。その結果をノーマライズする。それを行列のZの部分に直接入れる。</p>
<div class="webgl_math_center"><pre class="webgl_math">
+----+----+----+----+
|    |    |    |    |
+----+----+----+----+
|    |    |    |    |
+----+----+----+----+
| Zx | Zy | Zz |    |
+----+----+----+----+
|    |    |    |    |
+----+----+----+----+
</pre></div>

<p>この行列部分はZ軸を表している。この場合はカメラのZ軸になっている。
ベクトルをノーマライズするというのは1.0を表しているベクトルにするという意味である。
以前の<a href="webgl-2d-rotation.html">二次元回転についての記事</a>へ戻ったら,
単位円で二次元回転が出来た。三次元なら単位球体が必要で、
ノーマライズをされたベクトルは単位球体の表面の位置を表している。</p>
<p><div class="webgl_diagram_container">
  <iframe class="webgl_example " style="width: 400px; height: 300px;" src="/webgl/lessons/resources/cross-product-diagram.html?mode=0"></iframe>
  <div class="webgl_center"><span class='zaxis'>z軸</span></div>
</div>

</p>
<p>それだけでは情報が足りない。一つのベクトルだけで単位球体表面の一つにポイントが分かってくるが、
そのポイントからどの傾きにしたらいいかまだ分からない。他の行列の部分に何かを入れなきゃ。
特にX軸とY軸の部分に何か入れる必要がある。三次元行列の軸はほとんどお互いに垂直の関係であることもう知っている。
その上、カメラは普段真上を目指さないことも知っている。なので、上の方向が分かれば、今の場合（0,1,0）、
「外積」という計算でX軸とY軸を計算出来る。</p>
<p>数学としての外積の意味は全然分からないが、
分かっているところは2つの単位ベクトルを外積すると、その2つのベクトルに垂直なベクトルが出るということだ。
例えば、南東を目指しているベクトルと上を目指しているベクトルを外積すると、南西か北東を目指しているベクトルが出る。
その2つは南東と上に垂直になっているからだ。外積する順番によって逆の結果が出る。</p>
<p><style>
.xaxis { color: red; }
.yaxis { color: green; }
.zaxis { color: blue; }
.up { color: gray; font-weight: bold; }
</style>
いずれにせよ、<span class="zaxis">z軸</span>と<span class="up">上</span>を外積するとカメラの<span class="xaxis">x軸</span>が出る。</p>
<p><div class="webgl_diagram_container">
  <iframe class="webgl_example " style="width: 400px; height: 300px;" src="/webgl/lessons/resources/cross-product-diagram.html?mode=1"></iframe>
  <div class="webgl_center"><span class='up'>上</span>と<span class='zaxis'>z軸</span>の外積 = <span class='xaxis'>x軸</span></div>
</div>

</p>
<p><span class="xaxis">x軸</span>が出来たら<span class="zaxis">z軸</span>と<span class="xaxis">x軸</span>を外積したら<span class="yaxis">y軸</span>を計算出来る。</p>
<p><div class="webgl_diagram_container">
  <iframe class="webgl_example " style="width: 400px; height: 300px;" src="/webgl/lessons/resources/cross-product-diagram.html?mode=2"></iframe>
  <div class="webgl_center"><span class='zaxis'>z軸</span>と<span class='xaxis'>x軸</span>の外積 = <span class='yaxis'>y軸</span></div>
</div>

</p>
<p>最後に三つの軸を行列に入れなきゃ。その行列は<code class="notranslate" translate="no">cameraPosition</code>から<code class="notranslate" translate="no">target</code>を目指すと同じような向きになる。
 ただ<code class="notranslate" translate="no">position</code>も追加して、<code class="notranslate" translate="no">cameraPosition</code>から<code class="notranslate" translate="no">target</code>を目指す行列になる。</p>
<div class="webgl_math_center"><pre class="webgl_math">
+----+----+----+----+
| <span class="xaxis">Xx</span> | <span class="xaxis">Xy</span> | <span class="xaxis">Xz</span> |  0 |  <- <span class="xaxis">x軸</span>
+----+----+----+----+
| <span class="yaxis">Yx</span> | <span class="yaxis">Yy</span> | <span class="yaxis">Yz</span> |  0 |  <- <span class="yaxis">y軸</span>
+----+----+----+----+
| <span class="zaxis">Zx</span> | <span class="zaxis">Zy</span> | <span class="zaxis">Zz</span> |  0 |  <- <span class="zaxis">z軸</span>
+----+----+----+----+
| Tx | Ty | Tz |  1 |  <- カメラ位置
+----+----+----+----+
</pre></div>

<p>これは２つのベクトルの外積計算法である。</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">function cross(a, b) {
  return [a[1] * b[2] - a[2] * b[1],
          a[2] * b[0] - a[0] * b[2],
          a[0] * b[1] - a[1] * b[0]];
}
</code></pre><p>これは２つのベクトルの引き算のコードである。</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">function subtractVectors(a, b) {
  return [a[0] - b[0], a[1] - b[1], a[2] - b[2]];
}
</code></pre><p>これはベクトルをノーマライズするコードである。（単位ベクトルにする）</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">function normalize(v) {
  var length = Math.sqrt(v[0] * v[0] + v[1] * v[1] + v[2] * v[2]);
  // ０で割らないようにする。
  if (length &gt; 0.00001) {
    return [v[0] / length, v[1] / length, v[2] / length];
  } else {
    return [0, 0, 0];
  }
}
</code></pre><p>これは”lookAt”（目指す）行列を計算するコードである。</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">var m4 = {
  lookAt: function(cameraPosition, target, up) {
    var zAxis = normalize(subtractVectors(cameraPosition, target));
    var xAxis = normalize(cross(up, zAxis));
    var yAxis = normalize(cross(zAxis, xAxis));

    return [
       xAxis[0], xAxis[1], xAxis[2], 0,
       yAxis[0], yAxis[1], yAxis[2], 0,
       zAxis[0], zAxis[1], zAxis[2], 0,
       cameraPosition[0],
       cameraPosition[1],
       cameraPosition[2],
       1,
    ];
  }
</code></pre><p>そして、これはカメラを移動しながら、特定の「F」を目指す方法の一つである。</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">  ...

  // 最初の「F」の位置を計算する。
  var fPosition = [radius, 0, 0];

  // 行列数学でカメラを円の回りの位置を計算する。
  var cameraMatrix = m4.yRotation(cameraAngleRadians);
  cameraMatrix = m4.translate(cameraMatrix, 0, 0, radius * 1.5);

  // 行列からカメラの位置を取る。
  var cameraPosition = [
    cameraMatrix[12],
    cameraMatrix[13],
    cameraMatrix[14],
  ];

  var up = [0, 1, 0];

  // ”lookAt&quot;でカメラ行列を計算する。
  var cameraMatrix = m4.lookAt(cameraPosition, fPosition, up);

  // カメラの行列でヴュー行列を作成する。
  var viewMatrix = m4.inverse(cameraMatrix);

  ...
</code></pre><p>これはその結果である。</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-3d-camera-look-at.html%3Fui-cameraAngle%3D%25E3%2582%25AB%25E3%2583%25A1%25E3%2583%25A9%25E8%25A7%2592%25E5%25BA%25A6"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-3d-camera-look-at.html?ui-cameraAngle=%E3%82%AB%E3%83%A1%E3%83%A9%E8%A7%92%E5%BA%A6" target="_blank">クリックして別のウインドウを開く</a>
</div>

</p>
<p>スライダを操作して、カメラは特定の「F」を狙っていることに注目しよう。</p>
<p><code class="notranslate" translate="no">lookAt</code>の関数はカメラ以上に色々なことで使える。
通常使う場合はあるキャラクターの顔が別のキャラクターを追いかけることとか。
旋回砲塔を目標に向けることとか。オブジェクトが通路通りにすすで行くこととか。
そのオブジェクトが通路の何処にあるかを計算して、
その直後通路に何処に存在するかを計算して、その2つの位置を<code class="notranslate" translate="no">lookAt</code>の関数に入れたら、
そのオブジェクトが通路を進んでいく行列が出る。そうするとオブジェクトがただしい方向で通路の先に向かう。</p>
<p>次に<a href="webgl-animation.html">アニメーションを習おう</a>.</p>
<div class="webgl_bottombar">
<h3>lookAtの規格</h3>
<p>
通常三次元数学ライブラリには<code class="notranslate" translate="no">lookAt</code>関数がある。
それは大抵カメラ行列ではなく、ビュー行列を作成するの為に作られた。
つまり、カメラを移動して向きを決める行列じゃなくて、他の物を全てカメラの前に移動する行列を作る。
</p>
<p>
それはあまり便利じゃないような気がする。
以前に指摘したように<code class="notranslate" translate="no">lookAt</code>のような関数は多くの事に利用出来る。
ビュー行列が必要な場合、簡単に<code class="notranslate" translate="no">inverse</code>を呼び出せる。
でも、キャラクタの頭を他のキャラクタに追いかけさせる時とか、旋回砲塔を目標に狙わせる時とか、オブジェクトを移動させて、
向きを設定させる行列を作成する<code class="notranslate" translate="no">lookAt</code>関数の方が便利だと個人的に思う。
</p>
<div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-3d-camera-look-at-heads.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-3d-camera-look-at-heads.html" target="_blank">クリックして別のウインドウを開く</a>
</div>


</div>




    </div>
    <div class="lesson-sidebar">
        <select class="language">
    <option value="/webgl/lessons/webgl-3d-camera.html" >English</a>
    <option value="/webgl/lessons/fr/webgl-3d-camera.html" >Français</a>
    <option value="/webgl/lessons/ja/webgl-3d-camera.html" selected>日本語</a>
    <option value="/webgl/lessons/ko/webgl-3d-camera.html" >한국어</a>
    <option value="/webgl/lessons/pl/webgl-3d-camera.html" >Polski</a>
    <option value="/webgl/lessons/pt-br/webgl-3d-camera.html" >Portuguese</a>
    <option value="/webgl/lessons/ru/webgl-3d-camera.html" >Русский</a>
    <option value="/webgl/lessons/uk/webgl-3d-camera.html" >Українська</a>
    <option value="/webgl/lessons/zh_cn/webgl-3d-camera.html" >简体中文</a>
</select>


        <div id="toc">
          <ul>  <li>基本</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-fundamentals.html">基本</a></li>
<li><a href="/webgl/lessons/ja/webgl-how-it-works.html">WebGLの仕組み</a></li>
<li><a href="/webgl/lessons/ja/webgl-shaders-and-glsl.html">WebGLのシェーダーとGLSL</a></li>
<li><a href="/webgl/lessons/resources/webgl-state-diagram.html">WebGL State Diagram</a></li>
        </ul>
  <li>画像処理</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-image-processing.html">WebGLにおける画像処理</a></li>
<li><a href="/webgl/lessons/ja/webgl-image-processing-continued.html">WebGLにおける画像処理。続き</a></li>
        </ul>
  <li>2Dでの移動、回転、拡大縮小、行列計算</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-2d-translation.html">二次元での移動</a></li>
<li><a href="/webgl/lessons/ja/webgl-2d-rotation.html">二次元での回転</a></li>
<li><a href="/webgl/lessons/ja/webgl-2d-scale.html">二次元での拡大縮小</a></li>
<li><a href="/webgl/lessons/ja/webgl-2d-matrices.html">二次元での行列数学</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-3d-orthographic.html">三次元の正投影</a></li>
<li><a href="/webgl/lessons/ja/webgl-3d-perspective.html">三次元透視投影</a></li>
<li><a href="/webgl/lessons/ja/webgl-3d-camera.html">三次元のカメラ</a></li>
        </ul>
  <li>Lighting</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-3d-lighting-directional.html">三次元指向性光源</a></li>
<li><a href="/webgl/lessons/ja/webgl-3d-lighting-point.html">三次元点光源</a></li>
<li><a href="/webgl/lessons/ja/webgl-3d-lighting-spot.html">Spot Lighting</a></li>
        </ul>
  <li>Structure and Organization</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-less-code-more-fun.html">Less Code, More Fun</a></li>
<li><a href="/webgl/lessons/ja/webgl-drawing-multiple-things.html">Drawing Multiple Things</a></li>
<li><a href="/webgl/lessons/ja/webgl-scene-graph.html">Scene Graphs</a></li>
        </ul>
  <li>Geometry</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-3d-geometry-lathe.html">Geometry - Lathe</a></li>
<li><a href="/webgl/lessons/ja/webgl-load-obj.html">Loading .obj files</a></li>
<li><a href="/webgl/lessons/ja/webgl-load-obj-w-mtl.html">Loading .obj w .mtl files</a></li>
        </ul>
  <li>テクスチャ</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-3d-textures.html">テクスチャ</a></li>
<li><a href="/webgl/lessons/ja/webgl-data-textures.html">データテクスチャ</a></li>
<li><a href="/webgl/lessons/ja/webgl-2-textures.html">複数のテクスチャを使う</a></li>
<li><a href="/webgl/lessons/ja/webgl-cors-permission.html">Cross Origin Images</a></li>
<li><a href="/webgl/lessons/ja/webgl-3d-perspective-correct-texturemapping.html">Perspective Correct Texture Mapping</a></li>
<li><a href="/webgl/lessons/ja/webgl-planar-projection-mapping.html">Planar and Perspective Projection Mapping</a></li>
        </ul>
  <li>Rendering To A Texture</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-render-to-texture.html">Render to Texture</a></li>
        </ul>
  <li>Shadows</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-shadows.html">Shadows</a></li>
        </ul>
  <li>Techniques</li>
        <ul>
            <li>2D</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-2d-drawimage.html">2D - DrawImage</a></li>
<li><a href="/webgl/lessons/ja/webgl-2d-matrix-stack.html">2D - Matrix Stack</a></li>
<li><a href="/webgl/lessons/ja/webgl-sprites.html">Sprites</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-cube-maps.html">Cubemaps</a></li>
<li><a href="/webgl/lessons/ja/webgl-environment-maps.html">Environment maps</a></li>
<li><a href="/webgl/lessons/ja/webgl-skybox.html">Skyboxes</a></li>
<li><a href="/webgl/lessons/ja/webgl-skinning.html">Skinning</a></li>
<li><a href="/webgl/lessons/ja/webgl-fog.html">Fog</a></li>
<li><a href="/webgl/lessons/ja/webgl-picking.html">Picking (clicking on stuff)</a></li>
        </ul>
  <li>Text</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-text-html.html">Text - HTML</a></li>
<li><a href="/webgl/lessons/ja/webgl-text-canvas2d.html">Text - Canvas 2D</a></li>
<li><a href="/webgl/lessons/ja/webgl-text-texture.html">Text - Using a Texture</a></li>
<li><a href="/webgl/lessons/ja/webgl-text-glyphs.html">Text - Using a Glyph Texture</a></li>
        </ul>
  <li>テクスチャ</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-ramp-textures.html">Ramp Textures (Toon Shading)</a></li>
        </ul>
  <li>GPGPU</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-gpgpu.html">GPGPU</a></li>
        </ul>
        </ul>
  <li>Tips</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-smallest-programs.html">Smallest Programs</a></li>
<li><a href="/webgl/lessons/ja/webgl-drawing-without-data.html">Drawing Without Data</a></li>
<li><a href="/webgl/lessons/ja/webgl-shadertoy.html">Shadertoy</a></li>
<li><a href="/webgl/lessons/ja/webgl-pulling-vertices.html">Pulling Vertices</a></li>
        </ul>
  <li>Optimization</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-indexed-vertices.html">Indexed Vertices (gl.drawElements)</a></li>
<li><a href="/webgl/lessons/ja/webgl-instanced-drawing.html">Instanced Drawing</a></li>
        </ul>
  <li>その他のトピック</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-setup-and-installation.html">WebGLの開発環境</a></li>
<li><a href="/webgl/lessons/ja/webgl-boilerplate.html">WebGLのひな型コード</a></li>
<li><a href="/webgl/lessons/ja/webgl-resizing-the-canvas.html">WebGLとcanvasのリサイズ</a></li>
<li><a href="/webgl/lessons/ja/webgl-animation.html">アニメーション</a></li>
<li><a href="/webgl/lessons/ja/webgl-points-lines-triangles.html">点、線、三角形</a></li>
<li><a href="/webgl/lessons/ja/webgl-multiple-views.html">Multiple Views, Multiple Canvases</a></li>
<li><a href="/webgl/lessons/ja/webgl-visualizing-the-camera.html">Visualizing the Camera</a></li>
<li><a href="/webgl/lessons/ja/webgl-and-alpha.html">WebGL and Alpha</a></li>
<li><a href="/webgl/lessons/ja/webgl-2d-vs-3d-library.html">2D vs 3D libraries</a></li>
<li><a href="/webgl/lessons/ja/webgl-anti-patterns.html">Anti-Patterns</a></li>
<li><a href="/webgl/lessons/ja/webgl-matrix-vs-math.html">WebGL Matrices vs Math Matrices</a></li>
<li><a href="/webgl/lessons/ja/webgl-precision-issues.html">Precision Issues</a></li>
<li><a href="/webgl/lessons/ja/webgl-tips.html#screenshot">Taking a screenshot</a></li>
<li><a href="/webgl/lessons/ja/webgl-tips.html#preservedrawingbuffer">Prevent the Canvas Being Cleared</a></li>
<li><a href="/webgl/lessons/ja/webgl-tips.html#tabindex">Get Keyboard Input From a Canvas</a></li>
<li><a href="/webgl/lessons/ja/webgl-tips.html#html-background">Use WebGL as Background in HTML</a></li>
<li><a href="/webgl/lessons/ja/webgl-cross-platform-issues.html">Cross Platform Issues</a></li>
<li><a href="/webgl/lessons/ja/webgl-qna.html">Questions and Answers</a></li>
        </ul>
  <li>Reference</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-attributes.html">Attributes</a></li>
<li><a href="/webgl/lessons/ja/webgl-texture-units.html">Texture Units</a></li>
<li><a href="/webgl/lessons/ja/webgl-framebuffers.html">Framebuffers</a></li>
<li><a href="/webgl/lessons/ja/webgl-readpixels.html">readPixels</a></li>
<li><a href="/webgl/lessons/ja/webgl-references.html">References</a></li>
        </ul></ul>
<ul>
  <li><a href="/docs/">Helper API Docs(英語)</a></li>
  <li><a href="https://twgljs.org">TWGL, A tiny WebGL helper library</a></li>
  <li><a href="https://github.com/gfxfundamentals/webgl-fundamentals">github</a></li>
</ul>
        </div>
    </div>
    <div class="lesson-comments">
        <div>問題点/バグ? <a href="https://github.com/gfxfundamentals/webgl-fundamentals/issues">githubでissueを作成</a>.</div>

        <div id="disqus_thread"></div>
        <script>
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'webglfundamentals'; // required: replace example with your forum shortname
            var disqus_identifier = 'WebGL三次元でカメラ';
            var disqus_title = 'WebGL三次元でカメラ';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                if (window.location.hostname.indexOf("webglfundamentals.org") < 0) {
                    return;
                }
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </div>
</div>
</body>
<script>
const settings = {
  contribTemplate: "Thank you <a href=\"${html_url}\"><img src=\"${avatar_url}\"> ${login}</a><br>for <a href=\"https://github.com/${owner}/${repo}/commits?author=${login}\">${contributions} contributions</a>",
  owner: "gfxfundamentals",
  repo: "webgl-fundamentals",
};
</script>
<script src="/contributors.js"></script>
<script src="/3rdparty/jquery-1.11.2.min.js"></script>
<script src="/webgl/lessons/resources/prettify.js"></script>
<script src="/webgl/lessons/resources/lesson.js" type="module"></script>
<script>
</script>


</html>



