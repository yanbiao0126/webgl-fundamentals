<!DOCTYPE html>
<!-- this file is auto-generated from webgl/lessons/ko/webgl-fog.md. Do not edited directly -->
<!--
Copyright 2021 GFXFundamentals.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

*   Redistributions of source code must retain the above copyright
    notice, this list of conditions and the following disclaimer.

*   Redistributions in binary form must reproduce the above
    copyright notice, this list of conditions and the following disclaimer
    in the documentation and/or other materials provided with the
    distribution.

*   Neither the name of GFXFundamentals. nor the names of his
    contributors may be used to endorse or promote products derived from
    this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="안개를 구현하는 방법">
<meta name="keywords" content="webgl graphics">
<meta name="thumbnail" content="https://webglfundamentals.org/webgl/lessons/screenshots/webgl-fog_ko.jpg">

<meta property="og:title" content="WebGL 안개">
<meta property="og:type" content="website">
<meta property="og:image" content="https://webglfundamentals.org/webgl/lessons/screenshots/webgl-fog_ko.jpg">
<meta property="og:description" content="안개를 구현하는 방법">
<meta property="og:url" content="https://webglfundamentals.org/webgl/lessons/ko/webgl-fog.html">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@greggman">
<meta name="twitter:creator" content="@greggman">
<meta name="twitter:domain" content="webglfundamentals.org">
<meta name="twitter:title" content="WebGL 안개">
<meta name="twitter:url" content="https://webglfundamentals.org/webgl/lessons/ko/webgl-fog.html">
<meta name="twitter:description" content="안개를 구현하는 방법">
<meta name="twitter:image:src" content="https://webglfundamentals.org/webgl/lessons/screenshots/webgl-fog_ko.jpg">

<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@graph":[
    {
      "@type":"WebSite",
      "@id":"https://webglfundamentals.org/#website",
      "url":"https://webglfundamentals.org/",
      "name":"WebglFundamentals"
    },
    {
      "@type":"ImageObject",
      "@id":"https://webglfundamentals.org/webgl/lessons/ko/webgl-fog.html#primaryimage",
      "url":"https://webglfundamentals.org/webgl/lessons/screenshots/webgl-fog_ko.jpg",
      "width":1200,
      "height":630
    },
    {
      "@type":"WebPage",
      "@id":"https://webglfundamentals.org/webgl/lessons/ko/webgl-fog.html#webpage",
      "url":"https://webglfundamentals.org/webgl/lessons/ko/webgl-fog.html",
      "inLanguage":"ko",
      "name":"WebGL 안개",
      "keywords":"webgl graphics programming",
      "isPartOf":{
        "@id":"https://webglfundamentals.org/#website"
      },
      "primaryImageOfPage":{
        "@id":"https://webglfundamentals.org/webgl/lessons/ko/webgl-fog.html#primaryimage"
      }
    }
  ]
}
</script>


<title>WebGL 안개</title>
<link href="/webgl/lessons/resources/webglfundamentals-icon.png" rel="shortcut icon" type="image/png">
<link rel="stylesheet" href="/webgl/lessons/lang.css">
<link rel="stylesheet" href="/webgl/lessons/ko/lang.css">
<link rel="stylesheet" href="/webgl/lessons/resources/lesson.css">

  <link rel="alternate" hreflang="en" href="https://webglfundamentals.org/webgl/lessons/webgl-fog.html">
  <link rel="alternate" hreflang="fr" href="https://webglfundamentals.org/webgl/lessons/fr/webgl-fog.html">
  <link rel="alternate" hreflang="ja" href="https://webglfundamentals.org/webgl/lessons/ja/webgl-fog.html">
  <link rel="alternate" hreflang="ko" href="https://webglfundamentals.org/webgl/lessons/ko/webgl-fog.html">
  <link rel="alternate" hreflang="pl" href="https://webglfundamentals.org/webgl/lessons/pl/webgl-fog.html">
  <link rel="alternate" hreflang="pt-br" href="https://webglfundamentals.org/webgl/lessons/pt-br/webgl-fog.html">
  <link rel="alternate" hreflang="ru" href="https://webglfundamentals.org/webgl/lessons/ru/webgl-fog.html">
  <link rel="alternate" hreflang="zh_cn" href="https://webglfundamentals.org/webgl/lessons/zh_cn/webgl-fog.html">




</head>
<body>
<div class="webgl_navbar">
  <div>
    <select class="language">
    <option value="/webgl/lessons/webgl-fog.html" >English</a>
    <option value="/webgl/lessons/fr/webgl-fog.html" >Français</a>
    <option value="/webgl/lessons/ja/webgl-fog.html" >日本語</a>
    <option value="/webgl/lessons/ko/webgl-fog.html" selected>한국어</a>
    <option value="/webgl/lessons/pl/webgl-fog.html" >Polski</a>
    <option value="/webgl/lessons/pt-br/webgl-fog.html" >Portuguese</a>
    <option value="/webgl/lessons/ru/webgl-fog.html" >Русский</a>
    <option value="/webgl/lessons/zh_cn/webgl-fog.html" >简体中文</a>
</select>


    <a href="#toc">목차</a>
  </div>
</div>
<div class="webgl_header">
  <h1><a href="/webgl/lessons/ko/">WebGLFundamentals.org</a></h1>
<style>
#forkongithub>div {
    background: #000;
    color: #fff;
    font-family: arial,sans-serif;
    text-align: center;
    font-weight: bold;
    padding: 5px 40px;
    font-size: 0.9rem;
    line-height: 1.3rem;
    position: relative;
    transition: 0.5s;
    display: block;
    width: 400px;
    position: absolute;
    top: 0;
    right: 0;
    transform: translateX(200px) rotate(45deg) translate(10px,70px);
    box-shadow: 4px 4px 10px rgba(0,0,0,0.8);
    pointer-events: auto;
}
#forkongithub a {
  text-decoration: none;
  color: #fff;
}
#forkongithub>div:hover {
    background: #c11;
    color: #fff;
}
#forkongithub .contributors {
  font-size: 0.75rem;
  background: rgba(255,255,255,0.2);
  line-height: 1.2;
  padding: 0.1em;
}
#forkongithub>div::before,#forkongithub>div::after {
    content: "";
    width: 100%;
    display: block;
    position: absolute;
    top: 1px;
    left: 0;
    height: 1px;
    background: #fff;
}
#forkongithub>div::after {
    bottom: 1px;
    top: auto;
}

#forkongithub{
    z-index: 9999;
    /* needed for firefox */
    overflow: hidden;
    width: 300px;
    height: 300px;
    position: absolute;
    right: 0;
    top: 0;
    pointer-events: none;
}
#forkongithub svg{
  width: 1em;
  height: 1em;
  vertical-align: middle;
}
#forkongithub img {
  width: 1em;
  height: 1em;
  border-radius: 100%;
  vertical-align: middle;
}

@media (max-width: 900px) {
    #forkongithub>div {
        line-height: 1.2rem;
    }
}
@media (max-width: 700px) {
  #forkongithub {
    display: none;
  }
}
@media (max-width: 410px) {
    #forkongithub>div {
        font-size: 0.7rem;
        transform: translateX(150px) rotate(45deg) translate(20px,40px);
    }
}

</style>
<div id="forkongithub"><div><div><a href="https://github.com/gfxfundamentals/webgl-fundamentals">Fix, Fork, Contribute <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 136 133" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(3.92891,0,0,3.92891,67.867,129.125)">
        <path d="M0,-31.904C-8.995,-31.904 -16.288,-24.611 -16.288,-15.614C-16.288,-8.417 -11.621,-2.312 -5.148,-0.157C-4.333,-0.008 -4.036,-0.511 -4.036,-0.943C-4.036,-1.329 -4.05,-2.354 -4.058,-3.713C-8.589,-2.729 -9.545,-5.897 -9.545,-5.897C-10.286,-7.779 -11.354,-8.28 -11.354,-8.28C-12.833,-9.29 -11.242,-9.27 -11.242,-9.27C-9.607,-9.155 -8.747,-7.591 -8.747,-7.591C-7.294,-5.102 -4.934,-5.821 -4.006,-6.238C-3.858,-7.29 -3.438,-8.008 -2.972,-8.415C-6.589,-8.826 -10.392,-10.224 -10.392,-16.466C-10.392,-18.244 -9.757,-19.698 -8.715,-20.837C-8.883,-21.249 -9.442,-22.905 -8.556,-25.148C-8.556,-25.148 -7.188,-25.586 -4.076,-23.478C-2.777,-23.84 -1.383,-24.02 0.002,-24.026C1.385,-24.02 2.779,-23.84 4.08,-23.478C7.19,-25.586 8.555,-25.148 8.555,-25.148C9.444,-22.905 8.885,-21.249 8.717,-20.837C9.761,-19.698 10.392,-18.244 10.392,-16.466C10.392,-10.208 6.583,-8.831 2.954,-8.428C3.539,-7.925 4.06,-6.931 4.06,-5.411C4.06,-3.234 4.04,-1.477 4.04,-0.943C4.04,-0.507 4.333,0 5.16,-0.159C11.628,-2.318 16.291,-8.419 16.291,-15.614C16.291,-24.611 8.997,-31.904 0,-31.904" style="fill:white;"/>
    </g>
</svg>
</a></div></div></div>

</div>


<div class="container">
  <div class="lesson-title">
    <h1>WebGL 안개</h1>
  </div>
  <div class="lesson">
    <div class="lesson-main">
      <p>이 글은 WebGL 관련 시리즈의 일부입니다.
첫 글은 <a href="webgl-fundamentals.html">기초</a>로 시작했습니다.</p>
<p>WebGL에서 안개는 동작 방식을 생각하면 <em>가짜</em>처럼 보이기 때문에 굉장히 흥미롭습니다.
기본적으로 하는 일은 셰이더의 카메라 계산에 깊이나 거리를 사용하여 색상을 더 혹은 덜 안개색으로 만드는 겁니다.</p>
<p>다시 말해 이런 형태의 기본 방정식으로 시작합니다.</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-glsl">gl_FragColor = mix(originalColor, fogColor, fogAmount);
</code></pre>
<p>여기서 <code class="notranslate" translate="no">fogAmount</code>는 0에서 1사이의 값입니다.
<code class="notranslate" translate="no">mix</code> 함수는 처음 두 값을 혼합하는데요.
<code class="notranslate" translate="no">fogAmount</code>가 0일 때 <code class="notranslate" translate="no">mix</code>는 <code class="notranslate" translate="no">originalColor</code>를 반환합니다.
<code class="notranslate" translate="no">fogAmount</code>가 1일 때 <code class="notranslate" translate="no">mix</code>는 <code class="notranslate" translate="no">fogColor</code>를 반환합니다.
0과 1사이에서 두 색상의 비율을 얻게 됩니다.
다음과 같이 직접 <code class="notranslate" translate="no">mix</code>를 구현할 수도 있습니다.</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-glsl">gl_FragColor = originalColor + (fogColor - originalColor) * fogAmount;
</code></pre>
<p>이를 수행하는 셰이더를 만들어봅시다.
<a href="webgl-3d-textures.html">텍스처에 대한 글</a>의 텍스처가 적용된 큐브를 사용할 겁니다.</p>
<p>프래그먼트 셰이더에 믹싱을 추가해보겠습니다.</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-glsl">precision mediump float;

// 정점 셰이더에서 전달됩니다.
varying vec2 v_texcoord;

// 텍스처
uniform sampler2D u_texture;

+uniform vec4 u_fogColor;
+uniform float u_fogAmount;

void main() {
+  vec4 color = texture2D(u_texture, v_texcoord);
+  gl_FragColor = mix(color, u_fogColor, u_fogAmount);  
}
</code></pre>
<p>그런 다음 초기화할 때 새로운 유니폼 위치를 찾아야 합니다.</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">var fogColorLocation = gl.getUniformLocation(program, &quot;u_fogColor&quot;);
var fogAmountLocation = gl.getUniformLocation(program, &quot;u_fogAmount&quot;);
</code></pre>
<p>그리고 렌더링할 때 그것들을 설정합니다.</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">var fogColor = [0.8, 0.9, 1, 1];
var settings = {
  fogAmount: .5,
};

...

function drawScene(time) {
  ...

  // 캔버스와 깊이 버퍼를 안개색으로 지우기
  gl.clearColor(...fogColor);
  gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

  ...

  // 안개의 색상과 양 설정
  gl.uniform4fv(fogColorLocation, fogColor);
  gl.uniform1f(fogAmountLocation, settings.fogAmount);

  ...
}
</code></pre>
<p>슬라이더를 드래그하면 텍스처와 안개색 사이에서 변경할 수 있습니다.</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-3d-fog-just-mix.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-3d-fog-just-mix.html" target="_blank">새 창을 열려면 여기를 클릭</a>
</div>

</p>
<p>이제 안개 양을 전달하는 대신에 카메라의 깊이 등을 기반으로 계산해야 합니다.</p>
<p><a href="webgl-3d-camera.html">카메라에 대한 글</a>을 떠올려보면 뷰 행렬을 적용한 후에 모든 위치는 카메라에 상대적입니다.
카메라가 -z 축을 내려다보고 있으므로, 월드 행렬과 뷰 행렬로 곱한 후 z 위치를 보면, 카메라의 z 평면에서 얼마나 떨어져 있는 나타내는 값을 얻게 됩니다.</p>
<p>해당 데이터를 프래그먼트 셰이더로 전달하여 안개 양 계산에 사용할 수 있도록 정점 셰이더를 수정해봅시다.
이를 위해 <code class="notranslate" translate="no">u_matrix</code>를 두 부분으로 나누려고 하는데요.
바로 투영 행렬과 월드 뷰 행렬입니다.</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-glsl">attribute vec4 a_position;
attribute vec2 a_texcoord;

-uniform mat4 u_matrix;
+uniform mat4 u_worldView;
+uniform mat4 u_projection;

varying vec2 v_texcoord;
+varying float v_fogDepth;

void main() {
  // 위치에 행렬 곱하기
-  gl_Position = u_matrix * a_position;
+  gl_Position = u_projection * u_worldView * a_position;

  // 텍스처 좌표를 프래그먼트 셰이더로 전달
  v_texcoord = a_texcoord;

+  // 카메라를 기준으로 -z 위치만 전달합니다.
+  // 카메라는 -z 방향을 보고 있으므로, 일반적으로 카메라 앞의 물체는 -z 위치를 가지지만, 부정 연산으로 양수인 깊이를 얻습니다.
+  v_fogDepth = -(u_worldView * a_position).z;
}
</code></pre>
<p>이제 프래그먼트 세이더에서 어떤 값보다 깊이가 작으면 안개를 혼합하지 않도록 합니다. (fogAmount = 0)
어떤 값보다 깊이가 크면 안개를 100% 적용합니다. (fogAmount = 1)
이 두 값 사이에서 색상을 혼합하는데요.</p>
<p>그렇게 작동하는 코드를 작성할 수도 있지만 GLSL는 이를 수행하는 <code class="notranslate" translate="no">smoothstep</code> 함수를 가지고 있습니다.
여러분은 최소값, 최대값, 테스트 값을 전달하면 됩니다.
테스트 값이 최소값보다 작거나 같으면 0을 반환합니다.
테스트 값이 최대값보다 크거나 같으면 1을 반환합니다.
테스트 값이 이 두 값 사이에 있으면 최소값과 최대값 사이 테스트 값의 위치와 비례하는 0과 1사이의 값을 반환합니다.</p>
<p>안개 양을 계산하기 위해 이를 프래그먼트 셰이더에서 사용하는 것은 굉장히 쉽습니다.</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-glsl">precision mediump float;

// 정점 셰이더에서 전달됩니다.
varying vec2 v_texcoord;
varying float v_fogDepth;

// 텍스처
uniform sampler2D u_texture;
uniform vec4 u_fogColor;
-uniform float u_fogAmount;
+uniform float u_fogNear;
+uniform float u_fogFar;

void main() {
  vec4 color = texture2D(u_texture, v_texcoord);

+  float fogAmount = smoothstep(u_fogNear, u_fogFar, v_fogDepth);

-  gl_FragColor = mix(color, u_fogColor, u_fogAmount);  
+ gl_FragColor = mix(color, u_fogColor, fogAmount);  
}
</code></pre>
<p>당연히 초기화할 때 모든 유니폼을 찾아야 합니다.</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">// 유니폼 탐색
+var projectionLocation = gl.getUniformLocation(program, &quot;u_projection&quot;);
+var worldViewLocation = gl.getUniformLocation(program, &quot;u_worldView&quot;);
var textureLocation = gl.getUniformLocation(program, &quot;u_texture&quot;);
var fogColorLocation = gl.getUniformLocation(program, &quot;u_fogColor&quot;);
+var fogNearLocation = gl.getUniformLocation(program, &quot;u_fogNear&quot;);
+var fogFarLocation = gl.getUniformLocation(program, &quot;u_fogFar&quot;);
</code></pre>
<p>그리고 렌더링할 때 그것들을 설정합니다.</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">var fogColor = [0.8, 0.9, 1, 1];
var settings = {
-  fogAmount: .5,
+  fogNear: 1.1,
+  fogFar: 2.0,
};

// 장면 그리기
function drawScene(time) {
  ...

  // 투영 행렬 계산
  var aspect = gl.canvas.clientWidth / gl.canvas.clientHeight;
  var projectionMatrix =
      m4.perspective(fieldOfViewRadians, aspect, 1, 2000);

  var cameraPosition = [0, 0, 2];
  var up = [0, 1, 0];
  var target = [0, 0, 0];

  // lookAt을 사용하여 카메라 행렬 계산
  var cameraMatrix = m4.lookAt(cameraPosition, target, up);

  // 카메라 행렬로 뷰 행렬 만들기
  var viewMatrix = m4.inverse(cameraMatrix);

-  var viewProjectionMatrix = m4.multiply(projectionMatrix, viewMatrix);
-
-  var matrix = m4.xRotate(viewProjectionMatrix, modelXRotationRadians);
-  matrix = m4.yRotate(matrix, modelYRotationRadians);

+  var worldViewMatrix = m4.xRotate(viewMatrix, modelXRotationRadians);
+  worldViewMatrix = m4.yRotate(worldViewMatrix, modelYRotationRadians);

  // 행렬 설정
-  gl.uniformMatrix4fv(matrixLocation, false, matrix);
+  gl.uniformMatrix4fv(projectionLocation, false, projectionMatrix);
+  gl.uniformMatrix4fv(worldViewLocation, false, worldViewMatrix);

  // u_texture에 텍스처 유닛 0을 사용하도록 셰이더에 지시
  gl.uniform1i(textureLocation, 0);

  // 안개색, 근거리, 원거리 설정
  gl.uniform4fv(fogColorLocation, fogColor);
+  gl.uniform1f(fogNearLocation, settings.fogNear);
+  gl.uniform1f(fogFarLocation, settings.fogFar);
-  gl.uniform1f(fogAmountLocation, settings.fogAmount);
</code></pre>
<p>안개를 더 쉽게 확인할 수 있도록 거리별로 40개의 큐브를 그려보겠습니다.</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">var settings = {
  fogNear: 1.1,
  fogFar: 2.0,
+  xOff: 1.1,
+  zOff: 1.4,
};

...

const numCubes = 40;
for (let i = 0; i &lt;= numCubes; ++i) {
  var worldViewMatrix = m4.translate(viewMatrix, -2 + i * settings.xOff, 0, -i * settings.zOff);
  worldViewMatrix = m4.xRotate(worldViewMatrix, modelXRotationRadians + i * 0.1);
  worldViewMatrix = m4.yRotate(worldViewMatrix, modelYRotationRadians + i * 0.1);

  gl.uniformMatrix4fv(worldViewLocation, false, worldViewMatrix);

  // 지오메트리 그리기
  gl.drawArrays(gl.TRIANGLES, 0, 6 * 6);
}
</code></pre>
<p>이제 깊이 기반의 안개가 생깁니다.</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-3d-fog-depth-based.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-3d-fog-depth-based.html" target="_blank">새 창을 열려면 여기를 클릭</a>
</div>

</p>
<p>참고: <code class="notranslate" translate="no">fogNear</code>가 <code class="notranslate" translate="no">fogFar</code>보다 작거나 같으면 안 되지만 이를 확인하는 코드를 추가하지 않았기 때문에 둘 다 적절히 설정해야 합니다.</p>
<p>위에서 언급했듯이 저는 이게 속임수처럼 느껴집니다.
안개색이 배경색과 일치해야만 작동하기 때문인데요.
배경색을 바꾸면 환상은 사라집니다.</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">-gl.clearColor(...fogColor);
+gl.clearColor(1, 0, 0, 1);  // 빨간색
</code></pre>
<div class="webgl_center"><img src="../resources/fog-background-color-mismatch.png"></div>

<p>그러니 안개색과 일치하도록 배경색을 설정해야 한다는 것을 기억해주시면 좋겠습니다.</p>
<p>깊이를 사용하면 잘 동작하고 저렴한 방법이지만 문제가 있습니다.
카메라 주변에 객체의 원이 있다고 가정해봅시다.
카메라의 z 평면에서의 거리를 기반으로 얀개 양을 계산할 겁니다.
즉 카메라를 돌릴 때 뷰 공간 Z값이 0에 가까워지는 것에 따라 안개 속으로 들어가고 나가는 것처럼 보입니다.</p>
<div class="webgl_center"><img src="../resources/fog-depth.svg" style="width: 600px;"></div>

<p>이 예제에서 문제점을 볼 수 있습니다.</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-3d-fog-depth-based-issue.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-3d-fog-depth-based-issue.html" target="_blank">새 창을 열려면 여기를 클릭</a>
</div>

</p>
<p>위를 보면 카메라 바로 주위에 8개의 큐브가 원을 형성하고 있습니다.
카메라가 제자리에서 회전하고 있는데요.
즉 큐브는 항상 카메라와 같은 거리에 있지만 Z평면과는 다른 거리이기 때문에 안개량 계산 결과 가장자리 근처의 큐브가 안개 밖으로 나오게 됩니다.</p>
<p>대신에 모든 큐브에 대해 동일한 카메라와의 거리를 계산하여 고칠 수 있습니다.</p>
<div class="webgl_center"><img src="../resources/fog-distance.svg" style="width: 600px;"></div>

<p>이를 위해 뷰 공간의 정점 위치를 정점 셰이더에서 프래그먼트 셰이더로 전달해야 합니다.</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-glsl">attribute vec4 a_position;
attribute vec2 a_texcoord;

uniform mat4 u_worldView;
uniform mat4 u_projection;

varying vec2 v_texcoord;
-varying float v_fogDepth;
+varying vec3 v_position;

void main() {
  // 위치에 행렬 곱하기
  gl_Position = u_projection * u_worldView * a_position;

  // 텍스처 좌표를 프래그먼트 셰이더로 전달
  v_texcoord = a_texcoord;

-  // 카메라를 기준으로 -z 위치만 전달합니다.
-  // 카메라는 -z 방향을 보고 있으므로, 일반적으로 카메라 앞의 물체는 -z 위치를 가지지만, 부정 연산으로 양수인 깊이를 얻습니다.
-  v_fogDepth = -(u_worldView * a_position).z;
+  // 뷰 위치를 프래그먼트 셰이더로 전달
+  v_position = (u_worldView * a_position).xyz;
}
</code></pre>
<p>그런 다음 프래그먼트 셰이더에서 위치를 사용하여 거리를 계산할 수 있습니다.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">precision mediump float;

// 정점 셰이더에서 전달됩니다.
varying vec2 v_texcoord;
-varying float v_fogDepth;
+varying vec3 v_position;

// 텍스처
uniform sampler2D u_texture;
uniform vec4 u_fogColor;
uniform float u_fogNear;
uniform float u_fogFar;

void main() {
  vec4 color = texture2D(u_texture, v_texcoord);

-  float fogAmount = smoothstep(u_fogNear, u_fogFar, v_fogDepth);
+  float fogDistance = length(v_position);
+  float fogAmount = smoothstep(u_fogNear, u_fogFar, fogDistance);

  gl_FragColor = mix(color, u_fogColor, fogAmount);  
}
</code></pre><p>이제 카메라가 회전할 때 더 이상 큐브가 안개에서 나오지 않습니다.</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-3d-fog-distance-based.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-3d-fog-distance-based.html" target="_blank">새 창을 열려면 여기를 클릭</a>
</div>

</p>
<p>지금까지 모든 안개는 선형 계산을 사용했습니다.
다시 말해 안개색은 근거리와 원거리 사이에 선형적으로 적용됩니다.
현실 세계에서 보여지는 것처럼 안개는 기하급수적으로 작용하는데요.
뷰어로부터의 거리의 제곱에 따라 더 짙어집니다.
다음은 기하급수적인 안개에 대한 일반적인 방정식입니다.</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-glsl">#define LOG2 1.442695

fogAmount = 1. - exp2(-fogDensity * fogDensity * fogDistance * fogDistance * LOG2));
fogAmount = clamp(fogAmount, 0., 1.);
</code></pre>
<p>이걸 사용하려면 이런 식으로 프래그먼트 셰이더를 바꿔야 합니다.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">precision mediump float;

// 정점 셰이더에서 전달됩니다.
varying vec2 v_texcoord;
varying vec3 v_position;

// 텍스처
uniform sampler2D u_texture;
uniform vec4 u_fogColor;
-uniform float u_fogNear;
-uniform float u_fogFar;
+uniform float u_fogDensity;

void main() {
  vec4 color = texture2D(u_texture, v_texcoord);

  #define LOG2 1.442695

  float fogDistance = length(v_position);
-  float fogAmount = smoothstep(u_fogNear, u_fogFar, fogDistance);
+  float fogAmount = 1. - exp2(-u_fogDensity * u_fogDensity * fogDistance * fogDistance * LOG2);
  fogAmount = clamp(fogAmount, 0., 1.);

  gl_FragColor = mix(color, u_fogColor, fogAmount);  
}
</code></pre><p>그리고 거리 <em>exp2</em> 밀도 기반의 안개를 얻게 됩니다.</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-3d-fog-distance-exp2.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-3d-fog-distance-exp2.html" target="_blank">새 창을 열려면 여기를 클릭</a>
</div>

</p>
<p>밀도 기반의 안개에 대해 한 가지 주의해야 할 점은 근거리와 원거리 설정이 없다는 겁니다.
이게 더 현실적일 수 있지만 심미적 요구 사항에는 안 맞을 수도 있습니다.
어느 걸 선호하는 것은 디자인적인 결정입니다.</p>
<p>안개를 계산하는 다른 많은 방법이 있습니다.
저사양 GPU에서는 <code class="notranslate" translate="no">gl_FragCoord.z</code>를 사용할 수 있습니다.
<code class="notranslate" translate="no">gl_FragCoord</code>는 WebGL이 설정하는 전역 변수입니다.
<code class="notranslate" translate="no">x</code> 그리고 <code class="notranslate" translate="no">y</code> 컴포넌트는 그려지는 픽셀의 좌표입니다.
<code class="notranslate" translate="no">z</code> 좌표는 0에서 1사이 해당 픽셀의 깊이입니다.
바로 거리로 변환할 수는 없지만 근거리와 원거리에 대한 0에서 1사이의 값을 선택해서 안개처럼 보이도록 할 수 있습니다.
정점 셰이더에서 아무것도 프래그먼트 셰이더로 전달하지 않아도 되며 거리 계산이 필요하지 않으므로 이건 저전력 GPU에서 저렴한 안개 효과를 만드는 한 가지 방법입니다.</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-3d-fog-depth-based-gl_FragCoord.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-3d-fog-depth-based-gl_FragCoord.html" target="_blank">새 창을 열려면 여기를 클릭</a>
</div>

</p>

    </div>
    <div class="lesson-sidebar">
        <select class="language">
    <option value="/webgl/lessons/webgl-fog.html" >English</a>
    <option value="/webgl/lessons/fr/webgl-fog.html" >Français</a>
    <option value="/webgl/lessons/ja/webgl-fog.html" >日本語</a>
    <option value="/webgl/lessons/ko/webgl-fog.html" selected>한국어</a>
    <option value="/webgl/lessons/pl/webgl-fog.html" >Polski</a>
    <option value="/webgl/lessons/pt-br/webgl-fog.html" >Portuguese</a>
    <option value="/webgl/lessons/ru/webgl-fog.html" >Русский</a>
    <option value="/webgl/lessons/zh_cn/webgl-fog.html" >简体中文</a>
</select>


        <div id="toc">
          <ul>  <li>기초</li>
        <ul>
          <li><a href="/webgl/lessons/ko/webgl-fundamentals.html">기초</a></li>
<li><a href="/webgl/lessons/ko/webgl-how-it-works.html">작동 방식</a></li>
<li><a href="/webgl/lessons/ko/webgl-shaders-and-glsl.html">셰이더와 GLSL</a></li>
<li><a href="/webgl/lessons/resources/webgl-state-diagram.html">WebGL 상태 다이어그램</a></li>
        </ul>
  <li>이미지 처리</li>
        <ul>
          <li><a href="/webgl/lessons/ko/webgl-image-processing.html">이미지 처리</a></li>
<li><a href="/webgl/lessons/ko/webgl-image-processing-continued.html">이미지 처리 심화</a></li>
        </ul>
  <li>2D 평행 이동, 회전, 스케일, 행렬 수학</li>
        <ul>
          <li><a href="/webgl/lessons/ko/webgl-2d-translation.html">2D 평행 이동</a></li>
<li><a href="/webgl/lessons/ko/webgl-2d-rotation.html">2D 회전</a></li>
<li><a href="/webgl/lessons/ko/webgl-2d-scale.html">2D 스케일</a></li>
<li><a href="/webgl/lessons/ko/webgl-2d-matrices.html">2D 행렬</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgl/lessons/ko/webgl-3d-orthographic.html">3D 직교 투영</a></li>
<li><a href="/webgl/lessons/ko/webgl-3d-perspective.html">3D 원근 투영</a></li>
<li><a href="/webgl/lessons/ko/webgl-3d-camera.html">3D 카메라</a></li>
        </ul>
  <li>조명</li>
        <ul>
          <li><a href="/webgl/lessons/ko/webgl-3d-lighting-directional.html">방향성 조명</a></li>
<li><a href="/webgl/lessons/ko/webgl-3d-lighting-point.html">점 조명</a></li>
<li><a href="/webgl/lessons/ko/webgl-3d-lighting-spot.html">스포트라이트</a></li>
        </ul>
  <li>구조와 구성</li>
        <ul>
          <li><a href="/webgl/lessons/ko/webgl-less-code-more-fun.html">유틸리티 함수</a></li>
<li><a href="/webgl/lessons/ko/webgl-drawing-multiple-things.html">여러 물체 그리기</a></li>
<li><a href="/webgl/lessons/ko/webgl-scene-graph.html">장면 그래프</a></li>
        </ul>
  <li>지오메트리</li>
        <ul>
          <li><a href="/webgl/lessons/ko/webgl-3d-geometry-lathe.html">지오메트리 - 선반 가공</a></li>
<li><a href="/webgl/lessons/ko/webgl-load-obj.html">.obj 파일 로딩</a></li>
<li><a href="/webgl/lessons/ko/webgl-load-obj-w-mtl.html">.mtl 파일로 .obj 로딩</a></li>
        </ul>
  <li>텍스처</li>
        <ul>
          <li><a href="/webgl/lessons/ko/webgl-3d-textures.html">텍스처</a></li>
<li><a href="/webgl/lessons/ko/webgl-data-textures.html">데이터 텍스처</a></li>
<li><a href="/webgl/lessons/ko/webgl-2-textures.html">2개 이상의 텍스처 사용</a></li>
<li><a href="/webgl/lessons/ko/webgl-cors-permission.html">교차 출처 이미지</a></li>
<li><a href="/webgl/lessons/ko/webgl-3d-perspective-correct-texturemapping.html">원근 교정 텍스처 매핑</a></li>
<li><a href="/webgl/lessons/ko/webgl-planar-projection-mapping.html">평면 및 원근 투영 매핑</a></li>
        </ul>
  <li>텍스처 렌더링</li>
        <ul>
          <li><a href="/webgl/lessons/ko/webgl-render-to-texture.html">텍스처 렌더링</a></li>
        </ul>
  <li>그림자</li>
        <ul>
          <li><a href="/webgl/lessons/ko/webgl-shadows.html">그림자</a></li>
        </ul>
  <li>기법</li>
        <ul>
            <li>2D</li>
        <ul>
          <li><a href="/webgl/lessons/ko/webgl-2d-drawimage.html">2D - DrawImage</a></li>
<li><a href="/webgl/lessons/ko/webgl-2d-matrix-stack.html">2D - 행렬 스택</a></li>
<li><a href="/webgl/lessons/ko/webgl-sprites.html">스프라이트</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgl/lessons/ko/webgl-cube-maps.html">큐브맵</a></li>
<li><a href="/webgl/lessons/ko/webgl-environment-maps.html">환경맵</a></li>
<li><a href="/webgl/lessons/ko/webgl-skybox.html">스카이박스</a></li>
<li><a href="/webgl/lessons/ko/webgl-skinning.html">스키닝</a></li>
<li><a href="/webgl/lessons/ko/webgl-fog.html">안개</a></li>
<li><a href="/webgl/lessons/ko/webgl-picking.html">피킹 (물체 클릭)</a></li>
        </ul>
  <li>텍스트</li>
        <ul>
          <li><a href="/webgl/lessons/ko/webgl-text-html.html">텍스트 - HTML</a></li>
<li><a href="/webgl/lessons/ko/webgl-text-canvas2d.html">텍스트 - Canvas 2D</a></li>
<li><a href="/webgl/lessons/ko/webgl-text-texture.html">텍스트 - 텍스처 사용</a></li>
<li><a href="/webgl/lessons/ko/webgl-text-glyphs.html">텍스트 - 글리프 텍스처 사용</a></li>
        </ul>
  <li>텍스처</li>
        <ul>
          <li><a href="/webgl/lessons/ko/webgl-ramp-textures.html">램프 텍스처 (툰 셰이딩)</a></li>
        </ul>
  <li>GPGPU</li>
        <ul>
          <li><a href="/webgl/lessons/ko/webgl-gpgpu.html">GPGPU</a></li>
        </ul>
        </ul>
  <li>팁</li>
        <ul>
          <li><a href="/webgl/lessons/ko/webgl-smallest-programs.html">최소 프로그램</a></li>
<li><a href="/webgl/lessons/ko/webgl-drawing-without-data.html">데이터 없이 그리기</a></li>
<li><a href="/webgl/lessons/ko/webgl-shadertoy.html">Shadertoy</a></li>
<li><a href="/webgl/lessons/ko/webgl-pulling-vertices.html">정점 풀링</a></li>
        </ul>
  <li>최적화</li>
        <ul>
          <li><a href="/webgl/lessons/ko/webgl-indexed-vertices.html">색인된 정점 (gl.drawElements)</a></li>
<li><a href="/webgl/lessons/ko/webgl-instanced-drawing.html">색인된 그리기</a></li>
        </ul>
  <li>Misc</li>
        <ul>
          <li><a href="/webgl/lessons/ko/webgl-setup-and-installation.html">설정 및 설치</a></li>
<li><a href="/webgl/lessons/ko/webgl-boilerplate.html">상용구</a></li>
<li><a href="/webgl/lessons/ko/webgl-resizing-the-canvas.html">캔버스 크기 조정</a></li>
<li><a href="/webgl/lessons/ko/webgl-animation.html">애니메이션</a></li>
<li><a href="/webgl/lessons/ko/webgl-points-lines-triangles.html">점, 선, 삼각형</a></li>
<li><a href="/webgl/lessons/ko/webgl-multiple-views.html">다중 뷰, 다중 캔버스</a></li>
<li><a href="/webgl/lessons/ko/webgl-visualizing-the-camera.html">카메라 시각화</a></li>
<li><a href="/webgl/lessons/ko/webgl-and-alpha.html">WebGL 알파</a></li>
<li><a href="/webgl/lessons/ko/webgl-2d-vs-3d-library.html">2D vs 3D 라이브러리</a></li>
<li><a href="/webgl/lessons/ko/webgl-anti-patterns.html">안티 패턴</a></li>
<li><a href="/webgl/lessons/ko/webgl-matrix-vs-math.html">WebGL 행렬 vs 수학 행렬</a></li>
<li><a href="/webgl/lessons/ko/webgl-precision-issues.html">정밀도 문제</a></li>
<li><a href="/webgl/lessons/ko/webgl-tips.html#screenshot">스크린샷 찍기</a></li>
<li><a href="/webgl/lessons/ko/webgl-tips.html#preservedrawingbuffer">캔버스 지우기 방지</a></li>
<li><a href="/webgl/lessons/ko/webgl-tips.html#tabindex">캔버스 키보드 입력</a></li>
<li><a href="/webgl/lessons/ko/webgl-tips.html#html-background">WebGL 배경 제작</a></li>
<li><a href="/webgl/lessons/ko/webgl-cross-platform-issues.html">크로스 플랫폼 문제</a></li>
<li><a href="/webgl/lessons/ko/webgl-qna.html">질문 및 답변</a></li>
        </ul>
  <li>참고</li>
        <ul>
          <li><a href="/webgl/lessons/ko/webgl-attributes.html">속성</a></li>
<li><a href="/webgl/lessons/ko/webgl-texture-units.html">텍스처 유닛</a></li>
<li><a href="/webgl/lessons/ko/webgl-framebuffers.html">프레임 버퍼</a></li>
<li><a href="/webgl/lessons/ko/webgl-readpixels.html">readPixels</a></li>
<li><a href="/webgl/lessons/ko/webgl-references.html">참고 자료</a></li>
        </ul></ul>
<ul>
  <li><a href="/docs/">도우미 API 문서</a></li>
  <li><a href="https://twgljs.org">TWGL, 가벼운 WebGL 라이브러리</a></li>
  <li><a href="https://github.com/gfxfundamentals/webgl-fundamentals">Github</a></li>
</ul>

        </div>
    </div>
    <div class="lesson-comments">
        
    <div>이슈/버그는? <a href="https://github.com/gfxfundamentals/webgl-fundamentals/issues">Github</a>에 이슈를 만들어주세요.</div>
    <div class="lesson-comment-notes">
      코드 블록은 <b>&lt;pre&gt;&lt;code&gt;</b>여기에 코드 입력<b>&lt;/code&gt;&lt;/pre&gt;</b>를 사용해주세요
    </div>
  

        <div id="disqus_thread"></div>
        <script>
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'webglfundamentals'; // required: replace example with your forum shortname
            var disqus_identifier = 'WebGL 안개';
            var disqus_title = 'WebGL 안개';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                if (window.location.hostname.indexOf("webglfundamentals.org") < 0) {
                    return;
                }
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </div>
</div>
</body>
<script>
const settings = {
  contribTemplate: "Thank you <a href=\"${html_url}\"><img src=\"${avatar_url}\"> ${login}</a><br>for <a href=\"https://github.com/${owner}/${repo}/commits?author=${login}\">${contributions} contributions</a>",
  owner: "gfxfundamentals",
  repo: "webgl-fundamentals",
};
</script>
<script src="/contributors.js"></script>
<script src="/3rdparty/jquery-1.11.2.min.js"></script>
<script src="/webgl/lessons/resources/prettify.js"></script>
<script src="/webgl/lessons/resources/lesson.js" type="module"></script>
<script>
(function() {
  if (window.location.hostname.indexOf("webglfundamentals.org") < 0) {
      return;
  }

  function addScript(src, type, fn) {
    const script = document.createElement('script');
    const firstScript = document.getElementsByTagName('script')[0];
    script.async = true;
    script.defer = true;
    script.type = type || 'javascript';
    if (fn) {
      script.addEventListener('load', fn);
    }
    script.src = src;
    firstScript.parentNode.insertBefore(script, firstScript);
  }

  // can't do this because it would eat contexts
  //addScript('//gpustats.org/stats.js', 'module');

  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59804936-1', 'auto');
  ga('send', 'pageview');
}());
</script>


</html>



